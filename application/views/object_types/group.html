<?php foreach($my_groups as $id => $group_info): ?>
  <?php $current_state = " opened"; ?>
  <?php $display_group_name = ucwords($group_info['group_type']); ?>
  <?php $clean_time_range = str_replace(' ','-',$placeholder_info[$id]['time_range']); ?>
  <div class='reporting_object_container' id="reporting_object_container_<?= $id ?>">
    <div class="object_header" style="position:relative;">
      <div class="object_name">
        <div class="disclosure_triangle<?= $current_state ?>" id="disclosure_triangle_<?= $id ?>"></div>
        <span class="container_name"><?= $display_group_name ?> Grouping - <span class="displayed_group_name"><?= $group_info['group_name'] ?></span></span>
        <span><a href="<?= base_url() ?>index.php/reporting/view/<?= $my_object_type ?>/<?= $id ?>/<?= $clean_time_range ?>" target="_blank">[Details]</a></span>
      </div>
      <div class="object_name_short"><span class="displayed_group_name"><?= $group_info['group_name'] ?></span></div>
      <span class="container_id" id="container_id_<?= $id ?>" style="display:none;"><?= $id ?></span>
    </div>
    <div class="object_closeable" id="object_closeable_<?= $id ?>">
      <div class="object_body" id="object_body_<?= $id ?>">
        <div class="loading_blocker" id="loading_blocker_<?= $id ?>" style="display:none;"><div>Loading Updated Info...</div></div>
        <?php $this->load->view('object_types/group_body_placeholder.html',$placeholder_info[$id]); ?>
      </div>

      <div class="group_edit_section closed" id="group_edit_section_<?= $id ?>" style="display:none;">
        <div class="group_search_bar_container" id="group_search_bar_container_<?= $id ?>">
          <form onsubmit="return false;" id="group_search_form_<?= $id ?>" class="group_search_form">
            <h4>Edit Group Name</h4>
            <div class="group_name_edit_container" id="group_name_edit_container_<?= $id ?>">
              <input type="text" class="group_name_editor" id="group_name_editor_<?= $id ?>" name="group_name_editor_<?= $id ?>" placeholder="<?= $group_info['group_name'] ?>" />
              <div class="group_edit_confirm_buttons" style="display:none;">
                <div class="group_name_editor_commit change_icon_accept_reject accept" id="group_name_edit_done_button_<?= $id ?>" >&nbsp;</div>
                <div class="group_name_editor_commit change_icon_accept_reject reject" id="group_name_edit_cancel_button_<?= $id ?>" >&nbsp;</div>
              </div>
            </div>
            <h4>Change <?= plural(ucwords($my_object_type)) ?> in this Group</h4>
            <div class="search_input_container">
              <div class='magnifying_glass_icon' id='magnifying_glass_icon'>&nbsp;</div>
              <div class='clear_field_icon' id='clear_field_icon' style="display:none;">&nbsp;</div>
              <input class='object_search_box' id='object_search_box' type='text' placeholder="Search for a(n) <?= $my_object_type ?> to add to the report" />
              <input type="hidden" id="group_name_<?= $id ?>" name="group_name_<?= $id ?>" class="group_name" value="<?= $group_info['group_name'] ?>" />
              <input type="hidden" id="group_id_<?= $id ?>" name="group_id_<?= $id ?>" class="group_id" value="<?= $id ?>" />
              <input type="hidden" id="object_type_<?= $id ?>" name="object_type_<?= $id ?>" class="object_type" value="<?= $my_object_type ?>" />
            </div>
          </form>
        </div>
        <div id="object_search_results_container_<?= $id ?>" class="search_results_display"></div>
      </div>
      <div class="object_footer" id="object_footer_<?= $id ?>">
        <div id="edit_grouping_container_<?= $id ?>" class="edit_grouping_container">
          <input type="button" class="edit_grouping_button" id="edit_grouping_button_<?= $id ?>" name="edit_grouping_button_<?= $id ?>" value="Edit Group" />
        </div>
        <div id="message_container_footer_<?= $id ?>" class="message_container_footer"></div>
        <div id="time_range_container_<?= $id ?>" class="time_range_container pull-right">
          <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;<span></span> <b class="caret"></b>
        </div>
      </div>
    </div>
  </div>
  <script type='text/javascript'>
  //<![CDATA[
  $(function() {


      function cb(start, end) {
          $('#time_range_container_<?= $id ?> span').html(start.format('MM/DD/YYYY') + ' - ' + end.format('MM/DD/YYYY'));
          var tl_obj = $('#object_timeline_<?= $id ?>').highcharts();
          var start_timestamp = start.toDate().getTime();
          var end_timestamp = end.toDate().getTime();

          if(tl_obj){
            if(timeline_load_new_data_check(tl_obj,start_timestamp,end_timestamp)){
              load_new_group_timeline_data(tl_obj, object_type,'<?= $id ?>',start.format('YYYY-MM-DD'),end.format('YYYY-MM-DD'));
            }else{
              tl_obj.xAxis[0].update({
                min: start_timestamp,
                max: end_timestamp
              });
            }
          }
      }
      cb(moment(correctTZ(new Date('<?= $placeholder_info[$id]['times']['start_time_object']->format('Y-m-d'); ?>'))), moment(correctTZ(new Date('<?= $placeholder_info[$id]['times']['end_time_object']->format('Y-m-d'); ?>'))));

      $('#time_range_container_<?= $id ?>').daterangepicker({
          parentEl: '#object_footer_<?= $id ?>',
          minDate: '<?= $placeholder_info[$id]['times']['earliest_available_object']->format('m/d/Y'); ?>',
          maxDate: '<?= $placeholder_info[$id]['times']['latest_available_object']->format('m/d/Y'); ?>',
          startDate: '<?= $placeholder_info[$id]['times']['start_time_object']->format('m/d/Y'); ?>',
          endDate: '<?= $placeholder_info[$id]['times']['end_time_object']->format('m/d/Y'); ?>',
          autoUpdateInput: true,
          linkedCalendars:false,
          ranges: {
             'Last 7 Days': [moment().subtract(6, 'days'), moment()],
             'Last 30 Days': [moment().subtract(29, 'days'), moment()],
             'Last 3 Months': [moment().subtract(3, 'months'), moment()],
             'Last 6 Months': [moment().subtract(6, 'months'), moment()],
             'Last Year': [moment().subtract(12, 'months'), moment()],
          }
      }, cb);

  });
  //]]>
  </script>
<?php endforeach; ?>
